<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>게시판 - 홈</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
      }
      .navbar {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .main-content {
        min-height: calc(100vh - 200px);
        padding: 2rem 0;
      }
      .card {
        border: none;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.3s ease;
        margin-bottom: 1.5rem;
      }
      .card:hover {
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
      }
      .post-card {
        cursor: pointer;
      }
      .category-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        margin-right: 0.25rem;
      }
      .post-meta {
        color: #6c757d;
        font-size: 0.875rem;
      }
      footer {
        background-color: #343a40;
        color: #fff;
        padding: 2rem 0;
        margin-top: 3rem;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand fw-bold" href="/">
          <i class="bi bi-chat-square-text"></i> 게시판
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link active" href="/">홈</a>
            </li>
            <li class="nav-item" th:if="${isLoggedIn}">
              <a class="nav-link" href="/posts/new">
                <i class="bi bi-pencil-square"></i> 글쓰기
              </a>
            </li>
          </ul>
          <ul class="navbar-nav">
            <li class="nav-item" th:if="${isLoggedIn}">
              <a class="nav-link" href="/categories">
                <i class="bi bi-tags"></i> 카테고리 관리
              </a>
            </li>
            <li class="nav-item" th:if="${!isLoggedIn}">
              <a class="nav-link" href="/login">로그인</a>
            </li>
            <li class="nav-item" th:if="${!isLoggedIn}">
              <a class="nav-link" href="/signup">회원가입</a>
            </li>
            <li class="nav-item dropdown" th:if="${isLoggedIn}">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="userDropdown"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="bi bi-person-circle"></i>
                <span th:text="${currentUser.nickname}">사용자</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <span
                    class="dropdown-item-text text-muted"
                    th:text="${currentUser.email}"
                    >이메일</span
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <form th:action="@{/logout}" method="post" class="d-inline">
                    <button type="submit" class="dropdown-item">
                      <i class="bi bi-box-arrow-right"></i> 로그아웃
                    </button>
                  </form>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="main-content">
      <div class="container">
        <div
          th:if="${successMessage}"
          class="alert alert-success alert-dismissible fade show"
          role="alert"
        >
          <i class="bi bi-check-circle"></i>
          <span th:text="${successMessage}"></span>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
          ></button>
        </div>
        <div
          th:if="${errorMessage}"
          class="alert alert-danger alert-dismissible fade show"
          role="alert"
        >
          <i class="bi bi-exclamation-circle"></i>
          <span th:text="${errorMessage}"></span>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
          ></button>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-4">
          <h1 class="h3 mb-0">게시글 목록</h1>
          <a th:if="${isLoggedIn}" href="/posts/new" class="btn btn-primary">
            <i class="bi bi-pencil-square"></i> 글쓰기
          </a>
        </div>

        <div class="card mb-4 shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h6 class="card-title mb-0">
                <i class="bi bi-funnel-fill text-primary"></i> 카테고리 필터
              </h6>
              <a th:if="${isLoggedIn}" href="/categories" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-gear"></i> 관리
              </a>
            </div>
            <div th:if="${categories != null and !categories.isEmpty()}" class="d-flex flex-wrap gap-2">
              <a
                th:href="@{/}"
                th:class="${selectedCategoryId == null ? 'btn btn-primary' : 'btn btn-outline-secondary'}"
                class="btn"
              >
                <i class="bi bi-grid-3x3-gap"></i> 전체
              </a>
              <a
                th:each="category : ${categories}"
                th:href="@{'/?categoryId=' + ${category.id}}"
                th:class="${selectedCategoryId != null and selectedCategoryId == category.id ? 'btn btn-primary' : 'btn btn-outline-secondary'}"
                class="btn"
              >
                <i class="bi bi-tag"></i> <span th:text="${category.name}">카테고리</span>
              </a>
            </div>
            <div th:if="${categories == null or categories.isEmpty()}" class="text-center py-3">
              <p class="text-muted mb-2">
                <i class="bi bi-inbox"></i> 등록된 카테고리가 없습니다.
              </p>
              <a th:if="${isLoggedIn}" href="/categories" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-plus-circle"></i> 카테고리 추가하기
              </a>
            </div>
          </div>
        </div>

        <div th:if="${posts != null and !posts.isEmpty()}">
          <div
            th:each="post : ${posts}"
            class="card post-card shadow-sm mb-3"
            style="transition: transform 0.2s, box-shadow 0.2s;"
            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)';"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)';"
          >
            <div class="card-body p-4">
              <div
                class="d-flex justify-content-between align-items-start mb-3"
              >
                <h5 class="card-title mb-0 flex-grow-1">
                  <a
                    th:href="@{'/posts/' + ${post.id}}"
                    class="text-decoration-none text-dark fw-bold"
                    style="font-size: 1.1rem;"
                    th:text="${post.title}"
                    >제목</a
                  >
                </h5>
                <div
                  th:if="${post.categories != null and !post.categories.isEmpty()}"
                  class="ms-3"
                >
                  <span
                    th:each="category : ${post.categories}"
                    class="badge bg-primary category-badge me-1"
                    style="font-size: 0.75rem; padding: 0.35rem 0.65rem;"
                    th:text="${category.name}"
                    >카테고리</span
                  >
                </div>
              </div>
              <p
                class="card-text text-muted mb-3"
                style="line-height: 1.6; min-height: 3em;"
                th:text="${#strings.abbreviate(post.content, 200)}"
              >
                내용 미리보기...
              </p>
              <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                <div class="d-flex align-items-center gap-3">
                  <span class="post-meta">
                    <i class="bi bi-person-circle text-primary"></i>
                    <span th:text="${post.authorNickname != null ? post.authorNickname : post.authorEmail}">작성자</span>
                  </span>
                  <span class="post-meta">
                    <i class="bi bi-clock text-muted"></i>
                    <span
                      th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"
                      >날짜</span
                    >
                  </span>
                </div>
                <a
                  th:href="@{'/posts/' + ${post.id}}"
                  class="btn btn-sm btn-outline-primary"
                >
                  자세히 보기 <i class="bi bi-arrow-right"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
        <div
          th:if="${posts == null or posts.isEmpty()}"
          class="text-center py-5"
        >
          <i class="bi bi-inbox" style="font-size: 3rem; color: #dee2e6"></i>
          <p class="text-muted mt-3">등록된 게시글이 없습니다.</p>
          <a th:if="${isLoggedIn}" href="/posts/new" class="btn btn-primary"
            >첫 게시글 작성하기</a
          >
        </div>
      </div>
    </main>

    <footer>
      <div class="container text-center">
        <p class="mb-0">&copy; 2025 게시판. All rights reserved.</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
